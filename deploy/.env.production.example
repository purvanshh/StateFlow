# ===========================================
# StateFlow - Production Environment Template
# ===========================================
# Copy this file to .env.production and fill in actual values
# NEVER commit .env.production to version control
# Use secure secret management (AWS Secrets Manager, HashiCorp Vault, etc.)

# ===========================================
# Deployment Identification
# ===========================================
DEPLOYMENT_ID=production-v1
DEPLOYMENT_REGION=us-east-1

# ===========================================
# Supabase Configuration (Required)
# ===========================================
# Production Supabase project URL (no trailing slash)
SUPABASE_URL=https://your-project-id.supabase.co

# Supabase Anon Key (for client-side auth, limited permissions)
SUPABASE_ANON_KEY=your-supabase-anon-key

# Supabase Service Role Key (server-side only, admin permissions)
# WARNING: This has full database access - keep it secret!
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key

# ===========================================
# API Server Configuration (Required)
# ===========================================
API_PORT=4000
API_HOST=0.0.0.0
NODE_ENV=production

# ===========================================
# Frontend Configuration (Required)
# ===========================================
# Public API URL accessible from browser
NEXT_PUBLIC_API_URL=https://api.yourdomain.com

# Web application domain
NEXT_PUBLIC_APP_URL=https://app.yourdomain.com

# ===========================================
# JWT/Auth Configuration (Required)
# ===========================================
# Generate with: openssl rand -base64 64
# Minimum 32 characters, rotate every 90 days
JWT_SECRET=your-production-jwt-secret-min-32-chars-long

# JWT token expiration in seconds (default: 86400 = 24 hours)
JWT_EXPIRATION=86400

# ===========================================
# Worker Configuration (Production Tuning)
# ===========================================
# Number of concurrent workflow executions per worker
# Increase based on available CPU/memory
WORKER_CONCURRENCY=10

# Polling interval in milliseconds for new work
# Lower = faster response, higher = less DB load
POLL_INTERVAL=500

# Maximum retry attempts for failed workflows
RETRY_MAX_ATTEMPTS=3

# Delay between retries in milliseconds
RETRY_DELAY_MS=5000

# Worker replicas for horizontal scaling
WORKER_REPLICAS=3

# ===========================================
# Database Connection (Supabase PostgreSQL)
# ===========================================
# Direct PostgreSQL connection (optional, for advanced use)
DATABASE_URL=postgresql://postgres:password@db.your-project-id.supabase.co:5432/postgres

# Connection pool size
DB_POOL_SIZE=20

# Connection timeout in seconds
DB_CONNECTION_TIMEOUT=30

# ===========================================
# Monitoring & Observability
# ===========================================
# Enable Prometheus metrics endpoint
ENABLE_METRICS=true
METRICS_PORT=9090

# Enable structured JSON logging
LOG_FORMAT=json
LOG_LEVEL=info

# ===========================================
# Security Configuration
# ===========================================
# CORS allowed origins (comma-separated)
CORS_ORIGINS=https://app.yourdomain.com,https://admin.yourdomain.com

# Rate limiting: requests per minute per IP
RATE_LIMIT_PER_MINUTE=100

# Enable request body size limit (bytes)
MAX_REQUEST_BODY_SIZE=1048576

# ===========================================
# Grafana Configuration (Optional)
# ===========================================
GRAFANA_PASSWORD=your-secure-grafana-admin-password

# ===========================================
# Backup Configuration
# ===========================================
# S3 bucket for automated backups
BACKUP_S3_BUCKET=your-backup-bucket
BACKUP_S3_REGION=us-east-1

# AWS credentials for backup (use IAM roles in production)
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key

# Retention policy: days to keep backups
BACKUP_RETENTION_DAYS=30

# ===========================================
# Alerting Configuration
# ===========================================
# PagerDuty/Slack integration keys
PAGERDUTY_SERVICE_KEY=your-pagerduty-key
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK

# Health check alerting thresholds
ALERT_CPU_THRESHOLD=80
ALERT_MEMORY_THRESHOLD=85
ALERT_ERROR_RATE_THRESHOLD=5

# ===========================================
# Feature Flags
# ===========================================
# Enable/disable features in production
ENABLE_WORKFLOW_EXECUTION=true
ENABLE_DEBUG_ENDPOINTS=false
ENABLE_DETAILED_HEALTH_REPORTS=true
